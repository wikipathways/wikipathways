***************
*** 149,155 ****
  						return $rt->getFullURL();
  					}
  				}
! 				return $rt;
  			}
  		}
  		// No or invalid redirect
--- 149,155 ----
  						return $rt->getFullURL();
  					}
  				}
! 				return $rt->getFullURL();
  			}
  		}
  		// No or invalid redirect
***************
*** 1697,1704 ****
  		if( $this->doWatch() ) {
  			$wgOut->setPagetitle( wfMsg( 'addedwatch' ) );
  			$wgOut->setRobotpolicy( 'noindex,nofollow' );
! 
! 			$wgOut->addWikiMsg( 'addedwatchtext', $this->mTitle->getPrefixedText() );
  		}
  
  		$wgOut->returnToMain( true, $this->mTitle->getPrefixedText() );
--- 1697,1710 ----
  		if( $this->doWatch() ) {
  			$wgOut->setPagetitle( wfMsg( 'addedwatch' ) );
  			$wgOut->setRobotpolicy( 'noindex,nofollow' );
! 			$title = $this->mTitle;
! 	               $titleName = $title->getBaseText();
!         	       try {
!                 	        $pathway = Pathway::newFromTitle($title);
!                         	$titleName = $pathway->getName();
!                 	} catch(Exception $e) {}
!                 	$addedwatchtext = "The pathway \"[[$title|$titleName]]\" has been added to [[Special:Watchlist|your watchlist]].";
! 			$wgOut->addWikiText( $addedwatchtext);
  		}
  
  		$wgOut->returnToMain( true, $this->mTitle->getPrefixedText() );
***************
*** 1742,1749 ****
  		if( $this->doUnwatch() ) {
  			$wgOut->setPagetitle( wfMsg( 'removedwatch' ) );
  			$wgOut->setRobotpolicy( 'noindex,nofollow' );
! 
! 			$wgOut->addWikiMsg( 'removedwatchtext', $this->mTitle->getPrefixedText() );
  		}
  
  		$wgOut->returnToMain( true, $this->mTitle->getPrefixedText() );
--- 1748,1761 ----
  		if( $this->doUnwatch() ) {
  			$wgOut->setPagetitle( wfMsg( 'removedwatch' ) );
  			$wgOut->setRobotpolicy( 'noindex,nofollow' );
!                         $title = $this->mTitle;
!                        $titleName = $title->getBaseText();
!                        try {
!                                 $pathway = Pathway::newFromTitle($title);
!                                 $titleName = $pathway->getName();
!                         } catch(Exception $e) {}
!                         $removedwatchtext = "The pathway \"[[$title|$titleName]]\" has been removed from [[Special:Watchlist|your watchlist]].";
!                         $wgOut->addWikiText( $removedwatchtext);
  		}
  
  		$wgOut->returnToMain( true, $this->mTitle->getPrefixedText() );
***************
*** 2809,2830 ****
  		$lnk = $current
  			? wfMsg( 'currentrevisionlink' )
  			: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'currentrevisionlink' ) );
! 		$curdiff = $current
! 			? wfMsg( 'diff' )
! 			: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'diff' ), 'diff=cur&oldid='.$oldid );
  		$prev = $this->mTitle->getPreviousRevisionID( $oldid ) ;
  		$prevlink = $prev
  			? $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'previousrevision' ), 'direction=prev&oldid='.$oldid )
  			: wfMsg( 'previousrevision' );
! 		$prevdiff = $prev
! 			? $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'diff' ), 'diff=prev&oldid='.$oldid )
! 			: wfMsg( 'diff' );
  		$nextlink = $current
  			? wfMsg( 'nextrevision' )
  			: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'nextrevision' ), 'direction=next&oldid='.$oldid );
! 		$nextdiff = $current
! 			? wfMsg( 'diff' )
! 			: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'diff' ), 'diff=next&oldid='.$oldid );
  
  		$cdel='';
  		if( $wgUser->isAllowed( 'deleterevision' ) ) {
--- 2821,2852 ----
  		$lnk = $current
  			? wfMsg( 'currentrevisionlink' )
  			: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'currentrevisionlink' ) );
!                 $curdiff = "<a href='" . SITE_URL .
!                                 "/index.php?title=Special:DiffAppletPage&old={$oldid}&new={$this->mLatest}" .
!                                 "&pwTitle={$this->mTitle}'>diff</a>";
! 		//$curdiff = $current
! 		//	? wfMsg( 'diff' )
! 		//	: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'diff' ), 'diff=cur&oldid='.$oldid );
  		$prev = $this->mTitle->getPreviousRevisionID( $oldid ) ;
  		$prevlink = $prev
  			? $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'previousrevision' ), 'direction=prev&oldid='.$oldid )
  			: wfMsg( 'previousrevision' );
!                 $prevdiff = "<a href='" . SITE_URL .
!                                 "/index.php?title=Special:DiffAppletPage&old={$oldid}&new={$prev}" .
!                                 "&pwTitle={$this->mTitle}'>diff</a>";
! 		//$prevdiff = $prev
! 		//	? $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'diff' ), 'diff=prev&oldid='.$oldid )
! 		//	: wfMsg( 'diff' );
!                 $next = $this->mTitle->getNextRevisionID( $oldid ) ;
  		$nextlink = $current
  			? wfMsg( 'nextrevision' )
  			: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'nextrevision' ), 'direction=next&oldid='.$oldid );
!                 $nextdiff = "<a href='" . SITE_URL .
!                                 "/index.php?title=Special:DiffAppletPage&old={$oldid}&new={$next}" .
!                                 "&pwTitle={$this->mTitle}'>diff</a>";
! 		//$nextdiff = $current
! 		//	? wfMsg( 'diff' )
! 		//	: $sk->makeKnownLinkObj( $this->mTitle, wfMsg( 'diff' ), 'diff=next&oldid='.$oldid );
  
  		$cdel='';
  		if( $wgUser->isAllowed( 'deleterevision' ) ) {
